{"dependencies":[{"name":"./constants","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":52,"index":52}}],"key":"waDaw5D7vDr2hRFu0z1BqRCTzP4=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return createPersistoid;\n    }\n  });\n  var _constants = require(_dependencyMap[0], \"./constants\");\n  // @TODO remove once flow < 0.63 support is no longer required.\n  function createPersistoid(config) {\n    // defaults\n    var blacklist = config.blacklist || null;\n    var whitelist = config.whitelist || null;\n    var transforms = config.transforms || [];\n    var throttle = config.throttle || 0;\n    var storageKey = \"\".concat(config.keyPrefix !== undefined ? config.keyPrefix : _constants.KEY_PREFIX).concat(config.key);\n    var storage = config.storage;\n    var serialize;\n    if (config.serialize === false) {\n      serialize = function serialize(x) {\n        return x;\n      };\n    } else if (typeof config.serialize === 'function') {\n      serialize = config.serialize;\n    } else {\n      serialize = defaultSerialize;\n    }\n    var writeFailHandler = config.writeFailHandler || null; // initialize stateful values\n\n    var lastState = {};\n    var stagedState = {};\n    var keysToProcess = [];\n    var timeIterator = null;\n    var writePromise = null;\n    var update = function update(state) {\n      // add any changed keys to the queue\n      Object.keys(state).forEach(function (key) {\n        if (!passWhitelistBlacklist(key)) return; // is keyspace ignored? noop\n\n        if (lastState[key] === state[key]) return; // value unchanged? noop\n\n        if (keysToProcess.indexOf(key) !== -1) return; // is key already queued? noop\n\n        keysToProcess.push(key); // add key to queue\n      }); //if any key is missing in the new state which was present in the lastState,\n      //add it for processing too\n\n      Object.keys(lastState).forEach(function (key) {\n        if (state[key] === undefined && passWhitelistBlacklist(key) && keysToProcess.indexOf(key) === -1 && lastState[key] !== undefined) {\n          keysToProcess.push(key);\n        }\n      }); // start the time iterator if not running (read: throttle)\n\n      if (timeIterator === null) {\n        timeIterator = setInterval(processNextKey, throttle);\n      }\n      lastState = state;\n    };\n    function processNextKey() {\n      if (keysToProcess.length === 0) {\n        if (timeIterator) clearInterval(timeIterator);\n        timeIterator = null;\n        return;\n      }\n      var key = keysToProcess.shift();\n      var endState = transforms.reduce(function (subState, transformer) {\n        return transformer.in(subState, key, lastState);\n      }, lastState[key]);\n      if (endState !== undefined) {\n        try {\n          stagedState[key] = serialize(endState);\n        } catch (err) {\n          console.error('redux-persist/createPersistoid: error serializing state', err);\n        }\n      } else {\n        //if the endState is undefined, no need to persist the existing serialized content\n        delete stagedState[key];\n      }\n      if (keysToProcess.length === 0) {\n        writeStagedState();\n      }\n    }\n    function writeStagedState() {\n      // cleanup any removed keys just before write.\n      Object.keys(stagedState).forEach(function (key) {\n        if (lastState[key] === undefined) {\n          delete stagedState[key];\n        }\n      });\n      writePromise = storage.setItem(storageKey, serialize(stagedState)).catch(onWriteFail);\n    }\n    function passWhitelistBlacklist(key) {\n      if (whitelist && whitelist.indexOf(key) === -1 && key !== '_persist') return false;\n      if (blacklist && blacklist.indexOf(key) !== -1) return false;\n      return true;\n    }\n    function onWriteFail(err) {\n      // @TODO add fail handlers (typically storage full)\n      if (writeFailHandler) writeFailHandler(err);\n      if (err && process.env.NODE_ENV !== 'production') {\n        console.error('Error storing data', err);\n      }\n    }\n    var flush = function flush() {\n      while (keysToProcess.length !== 0) {\n        processNextKey();\n      }\n      return writePromise || Promise.resolve();\n    }; // return `persistoid`\n\n    return {\n      update: update,\n      flush: flush\n    };\n  } // @NOTE in the future this may be exposed via config\n\n  function defaultSerialize(data) {\n    return JSON.stringify(data);\n  }\n});","lineCount":125,"map":[[7,2,3,15,"Object"],[7,8,3,15],[7,9,3,15,"defineProperty"],[7,23,3,15],[7,24,3,15,"exports"],[7,31,3,15],[8,4,3,15,"enumerable"],[8,14,3,15],[9,4,3,15,"get"],[9,7,3,15],[9,18,3,15,"get"],[9,19,3,15],[10,6,3,15],[10,13,3,15,"createPersistoid"],[10,29,3,15],[11,4,3,15],[12,2,3,15],[13,2,1,0],[13,6,1,0,"_constants"],[13,16,1,0],[13,19,1,0,"require"],[13,26,1,0],[13,27,1,0,"_dependencyMap"],[13,41,1,0],[14,2,2,0],[15,2,3,15],[15,11,3,24,"createPersistoid"],[15,27,3,40,"createPersistoid"],[15,28,3,41,"config"],[15,34,3,47],[15,36,3,49],[16,4,4,2],[17,4,5,2],[17,8,5,6,"blacklist"],[17,17,5,15],[17,20,5,18,"config"],[17,26,5,24],[17,27,5,25,"blacklist"],[17,36,5,34],[17,40,5,38],[17,44,5,42],[18,4,6,2],[18,8,6,6,"whitelist"],[18,17,6,15],[18,20,6,18,"config"],[18,26,6,24],[18,27,6,25,"whitelist"],[18,36,6,34],[18,40,6,38],[18,44,6,42],[19,4,7,2],[19,8,7,6,"transforms"],[19,18,7,16],[19,21,7,19,"config"],[19,27,7,25],[19,28,7,26,"transforms"],[19,38,7,36],[19,42,7,40],[19,44,7,42],[20,4,8,2],[20,8,8,6,"throttle"],[20,16,8,14],[20,19,8,17,"config"],[20,25,8,23],[20,26,8,24,"throttle"],[20,34,8,32],[20,38,8,36],[20,39,8,37],[21,4,9,2],[21,8,9,6,"storageKey"],[21,18,9,16],[21,21,9,19],[21,23,9,21],[21,24,9,22,"concat"],[21,30,9,28],[21,31,9,29,"config"],[21,37,9,35],[21,38,9,36,"keyPrefix"],[21,47,9,45],[21,52,9,50,"undefined"],[21,61,9,59],[21,64,9,62,"config"],[21,70,9,68],[21,71,9,69,"keyPrefix"],[21,80,9,78],[21,83,9,81,"KEY_PREFIX"],[21,93,9,91],[21,94,9,91,"KEY_PREFIX"],[21,104,9,91],[21,105,9,92],[21,106,9,93,"concat"],[21,112,9,99],[21,113,9,100,"config"],[21,119,9,106],[21,120,9,107,"key"],[21,123,9,110],[21,124,9,111],[22,4,10,2],[22,8,10,6,"storage"],[22,15,10,13],[22,18,10,16,"config"],[22,24,10,22],[22,25,10,23,"storage"],[22,32,10,30],[23,4,11,2],[23,8,11,6,"serialize"],[23,17,11,15],[24,4,13,2],[24,8,13,6,"config"],[24,14,13,12],[24,15,13,13,"serialize"],[24,24,13,22],[24,29,13,27],[24,34,13,32],[24,36,13,34],[25,6,14,4,"serialize"],[25,15,14,13],[25,18,14,16],[25,27,14,25,"serialize"],[25,36,14,34,"serialize"],[25,37,14,35,"x"],[25,38,14,36],[25,40,14,38],[26,8,15,6],[26,15,15,13,"x"],[26,16,15,14],[27,6,16,4],[27,7,16,5],[28,4,17,2],[28,5,17,3],[28,11,17,9],[28,15,17,13],[28,22,17,20,"config"],[28,28,17,26],[28,29,17,27,"serialize"],[28,38,17,36],[28,43,17,41],[28,53,17,51],[28,55,17,53],[29,6,18,4,"serialize"],[29,15,18,13],[29,18,18,16,"config"],[29,24,18,22],[29,25,18,23,"serialize"],[29,34,18,32],[30,4,19,2],[30,5,19,3],[30,11,19,9],[31,6,20,4,"serialize"],[31,15,20,13],[31,18,20,16,"defaultSerialize"],[31,34,20,32],[32,4,21,2],[33,4,23,2],[33,8,23,6,"writeFailHandler"],[33,24,23,22],[33,27,23,25,"config"],[33,33,23,31],[33,34,23,32,"writeFailHandler"],[33,50,23,48],[33,54,23,52],[33,58,23,56],[33,59,23,57],[33,60,23,58],[35,4,25,2],[35,8,25,6,"lastState"],[35,17,25,15],[35,20,25,18],[35,21,25,19],[35,22,25,20],[36,4,26,2],[36,8,26,6,"stagedState"],[36,19,26,17],[36,22,26,20],[36,23,26,21],[36,24,26,22],[37,4,27,2],[37,8,27,6,"keysToProcess"],[37,21,27,19],[37,24,27,22],[37,26,27,24],[38,4,28,2],[38,8,28,6,"timeIterator"],[38,20,28,18],[38,23,28,21],[38,27,28,25],[39,4,29,2],[39,8,29,6,"writePromise"],[39,20,29,18],[39,23,29,21],[39,27,29,25],[40,4,31,2],[40,8,31,6,"update"],[40,14,31,12],[40,17,31,15],[40,26,31,24,"update"],[40,32,31,30,"update"],[40,33,31,31,"state"],[40,38,31,36],[40,40,31,38],[41,6,32,4],[42,6,33,4,"Object"],[42,12,33,10],[42,13,33,11,"keys"],[42,17,33,15],[42,18,33,16,"state"],[42,23,33,21],[42,24,33,22],[42,25,33,23,"forEach"],[42,32,33,30],[42,33,33,31],[42,43,33,41,"key"],[42,46,33,44],[42,48,33,46],[43,8,34,6],[43,12,34,10],[43,13,34,11,"passWhitelistBlacklist"],[43,35,34,33],[43,36,34,34,"key"],[43,39,34,37],[43,40,34,38],[43,42,34,40],[43,49,34,47],[43,50,34,48],[45,8,36,6],[45,12,36,10,"lastState"],[45,21,36,19],[45,22,36,20,"key"],[45,25,36,23],[45,26,36,24],[45,31,36,29,"state"],[45,36,36,34],[45,37,36,35,"key"],[45,40,36,38],[45,41,36,39],[45,43,36,41],[45,50,36,48],[45,51,36,49],[47,8,38,6],[47,12,38,10,"keysToProcess"],[47,25,38,23],[47,26,38,24,"indexOf"],[47,33,38,31],[47,34,38,32,"key"],[47,37,38,35],[47,38,38,36],[47,43,38,41],[47,44,38,42],[47,45,38,43],[47,47,38,45],[47,54,38,52],[47,55,38,53],[49,8,40,6,"keysToProcess"],[49,21,40,19],[49,22,40,20,"push"],[49,26,40,24],[49,27,40,25,"key"],[49,30,40,28],[49,31,40,29],[49,32,40,30],[49,33,40,31],[50,6,41,4],[50,7,41,5],[50,8,41,6],[50,9,41,7],[50,10,41,8],[51,6,42,4],[53,6,44,4,"Object"],[53,12,44,10],[53,13,44,11,"keys"],[53,17,44,15],[53,18,44,16,"lastState"],[53,27,44,25],[53,28,44,26],[53,29,44,27,"forEach"],[53,36,44,34],[53,37,44,35],[53,47,44,45,"key"],[53,50,44,48],[53,52,44,50],[54,8,45,6],[54,12,45,10,"state"],[54,17,45,15],[54,18,45,16,"key"],[54,21,45,19],[54,22,45,20],[54,27,45,25,"undefined"],[54,36,45,34],[54,40,45,38,"passWhitelistBlacklist"],[54,62,45,60],[54,63,45,61,"key"],[54,66,45,64],[54,67,45,65],[54,71,45,69,"keysToProcess"],[54,84,45,82],[54,85,45,83,"indexOf"],[54,92,45,90],[54,93,45,91,"key"],[54,96,45,94],[54,97,45,95],[54,102,45,100],[54,103,45,101],[54,104,45,102],[54,108,45,106,"lastState"],[54,117,45,115],[54,118,45,116,"key"],[54,121,45,119],[54,122,45,120],[54,127,45,125,"undefined"],[54,136,45,134],[54,138,45,136],[55,10,46,8,"keysToProcess"],[55,23,46,21],[55,24,46,22,"push"],[55,28,46,26],[55,29,46,27,"key"],[55,32,46,30],[55,33,46,31],[56,8,47,6],[57,6,48,4],[57,7,48,5],[57,8,48,6],[57,9,48,7],[57,10,48,8],[59,6,50,4],[59,10,50,8,"timeIterator"],[59,22,50,20],[59,27,50,25],[59,31,50,29],[59,33,50,31],[60,8,51,6,"timeIterator"],[60,20,51,18],[60,23,51,21,"setInterval"],[60,34,51,32],[60,35,51,33,"processNextKey"],[60,49,51,47],[60,51,51,49,"throttle"],[60,59,51,57],[60,60,51,58],[61,6,52,4],[62,6,54,4,"lastState"],[62,15,54,13],[62,18,54,16,"state"],[62,23,54,21],[63,4,55,2],[63,5,55,3],[64,4,57,2],[64,13,57,11,"processNextKey"],[64,27,57,25,"processNextKey"],[64,28,57,25],[64,30,57,28],[65,6,58,4],[65,10,58,8,"keysToProcess"],[65,23,58,21],[65,24,58,22,"length"],[65,30,58,28],[65,35,58,33],[65,36,58,34],[65,38,58,36],[66,8,59,6],[66,12,59,10,"timeIterator"],[66,24,59,22],[66,26,59,24,"clearInterval"],[66,39,59,37],[66,40,59,38,"timeIterator"],[66,52,59,50],[66,53,59,51],[67,8,60,6,"timeIterator"],[67,20,60,18],[67,23,60,21],[67,27,60,25],[68,8,61,6],[69,6,62,4],[70,6,64,4],[70,10,64,8,"key"],[70,13,64,11],[70,16,64,14,"keysToProcess"],[70,29,64,27],[70,30,64,28,"shift"],[70,35,64,33],[70,36,64,34],[70,37,64,35],[71,6,65,4],[71,10,65,8,"endState"],[71,18,65,16],[71,21,65,19,"transforms"],[71,31,65,29],[71,32,65,30,"reduce"],[71,38,65,36],[71,39,65,37],[71,49,65,47,"subState"],[71,57,65,55],[71,59,65,57,"transformer"],[71,70,65,68],[71,72,65,70],[72,8,66,6],[72,15,66,13,"transformer"],[72,26,66,24],[72,27,66,25,"in"],[72,29,66,27],[72,30,66,28,"subState"],[72,38,66,36],[72,40,66,38,"key"],[72,43,66,41],[72,45,66,43,"lastState"],[72,54,66,52],[72,55,66,53],[73,6,67,4],[73,7,67,5],[73,9,67,7,"lastState"],[73,18,67,16],[73,19,67,17,"key"],[73,22,67,20],[73,23,67,21],[73,24,67,22],[74,6,69,4],[74,10,69,8,"endState"],[74,18,69,16],[74,23,69,21,"undefined"],[74,32,69,30],[74,34,69,32],[75,8,70,6],[75,12,70,10],[76,10,71,8,"stagedState"],[76,21,71,19],[76,22,71,20,"key"],[76,25,71,23],[76,26,71,24],[76,29,71,27,"serialize"],[76,38,71,36],[76,39,71,37,"endState"],[76,47,71,45],[76,48,71,46],[77,8,72,6],[77,9,72,7],[77,10,72,8],[77,17,72,15,"err"],[77,20,72,18],[77,22,72,20],[78,10,73,8,"console"],[78,17,73,15],[78,18,73,16,"error"],[78,23,73,21],[78,24,73,22],[78,81,73,79],[78,83,73,81,"err"],[78,86,73,84],[78,87,73,85],[79,8,74,6],[80,6,75,4],[80,7,75,5],[80,13,75,11],[81,8,76,6],[82,8,77,6],[82,15,77,13,"stagedState"],[82,26,77,24],[82,27,77,25,"key"],[82,30,77,28],[82,31,77,29],[83,6,78,4],[84,6,80,4],[84,10,80,8,"keysToProcess"],[84,23,80,21],[84,24,80,22,"length"],[84,30,80,28],[84,35,80,33],[84,36,80,34],[84,38,80,36],[85,8,81,6,"writeStagedState"],[85,24,81,22],[85,25,81,23],[85,26,81,24],[86,6,82,4],[87,4,83,2],[88,4,85,2],[88,13,85,11,"writeStagedState"],[88,29,85,27,"writeStagedState"],[88,30,85,27],[88,32,85,30],[89,6,86,4],[90,6,87,4,"Object"],[90,12,87,10],[90,13,87,11,"keys"],[90,17,87,15],[90,18,87,16,"stagedState"],[90,29,87,27],[90,30,87,28],[90,31,87,29,"forEach"],[90,38,87,36],[90,39,87,37],[90,49,87,47,"key"],[90,52,87,50],[90,54,87,52],[91,8,88,6],[91,12,88,10,"lastState"],[91,21,88,19],[91,22,88,20,"key"],[91,25,88,23],[91,26,88,24],[91,31,88,29,"undefined"],[91,40,88,38],[91,42,88,40],[92,10,89,8],[92,17,89,15,"stagedState"],[92,28,89,26],[92,29,89,27,"key"],[92,32,89,30],[92,33,89,31],[93,8,90,6],[94,6,91,4],[94,7,91,5],[94,8,91,6],[95,6,92,4,"writePromise"],[95,18,92,16],[95,21,92,19,"storage"],[95,28,92,26],[95,29,92,27,"setItem"],[95,36,92,34],[95,37,92,35,"storageKey"],[95,47,92,45],[95,49,92,47,"serialize"],[95,58,92,56],[95,59,92,57,"stagedState"],[95,70,92,68],[95,71,92,69],[95,72,92,70],[95,73,92,71,"catch"],[95,78,92,76],[95,79,92,77,"onWriteFail"],[95,90,92,88],[95,91,92,89],[96,4,93,2],[97,4,95,2],[97,13,95,11,"passWhitelistBlacklist"],[97,35,95,33,"passWhitelistBlacklist"],[97,36,95,34,"key"],[97,39,95,37],[97,41,95,39],[98,6,96,4],[98,10,96,8,"whitelist"],[98,19,96,17],[98,23,96,21,"whitelist"],[98,32,96,30],[98,33,96,31,"indexOf"],[98,40,96,38],[98,41,96,39,"key"],[98,44,96,42],[98,45,96,43],[98,50,96,48],[98,51,96,49],[98,52,96,50],[98,56,96,54,"key"],[98,59,96,57],[98,64,96,62],[98,74,96,72],[98,76,96,74],[98,83,96,81],[98,88,96,86],[99,6,97,4],[99,10,97,8,"blacklist"],[99,19,97,17],[99,23,97,21,"blacklist"],[99,32,97,30],[99,33,97,31,"indexOf"],[99,40,97,38],[99,41,97,39,"key"],[99,44,97,42],[99,45,97,43],[99,50,97,48],[99,51,97,49],[99,52,97,50],[99,54,97,52],[99,61,97,59],[99,66,97,64],[100,6,98,4],[100,13,98,11],[100,17,98,15],[101,4,99,2],[102,4,101,2],[102,13,101,11,"onWriteFail"],[102,24,101,22,"onWriteFail"],[102,25,101,23,"err"],[102,28,101,26],[102,30,101,28],[103,6,102,4],[104,6,103,4],[104,10,103,8,"writeFailHandler"],[104,26,103,24],[104,28,103,26,"writeFailHandler"],[104,44,103,42],[104,45,103,43,"err"],[104,48,103,46],[104,49,103,47],[105,6,105,4],[105,10,105,8,"err"],[105,13,105,11],[105,17,105,15,"process"],[105,24,105,22],[105,25,105,23,"env"],[105,28,105,26],[105,29,105,27,"NODE_ENV"],[105,37,105,35],[105,42,105,40],[105,54,105,52],[105,56,105,54],[106,8,106,6,"console"],[106,15,106,13],[106,16,106,14,"error"],[106,21,106,19],[106,22,106,20],[106,42,106,40],[106,44,106,42,"err"],[106,47,106,45],[106,48,106,46],[107,6,107,4],[108,4,108,2],[109,4,110,2],[109,8,110,6,"flush"],[109,13,110,11],[109,16,110,14],[109,25,110,23,"flush"],[109,30,110,28,"flush"],[109,31,110,28],[109,33,110,31],[110,6,111,4],[110,13,111,11,"keysToProcess"],[110,26,111,24],[110,27,111,25,"length"],[110,33,111,31],[110,38,111,36],[110,39,111,37],[110,41,111,39],[111,8,112,6,"processNextKey"],[111,22,112,20],[111,23,112,21],[111,24,112,22],[112,6,113,4],[113,6,115,4],[113,13,115,11,"writePromise"],[113,25,115,23],[113,29,115,27,"Promise"],[113,36,115,34],[113,37,115,35,"resolve"],[113,44,115,42],[113,45,115,43],[113,46,115,44],[114,4,116,2],[114,5,116,3],[114,6,116,4],[114,7,116,5],[116,4,119,2],[116,11,119,9],[117,6,120,4,"update"],[117,12,120,10],[117,14,120,12,"update"],[117,20,120,18],[118,6,121,4,"flush"],[118,11,121,9],[118,13,121,11,"flush"],[119,4,122,2],[119,5,122,3],[120,2,123,0],[120,3,123,1],[120,4,123,2],[122,2,125,0],[122,11,125,9,"defaultSerialize"],[122,27,125,25,"defaultSerialize"],[122,28,125,26,"data"],[122,32,125,30],[122,34,125,32],[123,4,126,2],[123,11,126,9,"JSON"],[123,15,126,13],[123,16,126,14,"stringify"],[123,25,126,23],[123,26,126,24,"data"],[123,30,126,28],[123,31,126,29],[124,2,127,0],[125,0,127,1],[125,3]],"functionMap":{"names":["<global>","createPersistoid","serialize","update","Object.keys.forEach$argument_0","processNextKey","transforms.reduce$argument_0","writeStagedState","passWhitelistBlacklist","onWriteFail","flush","defaultSerialize"],"mappings":"AAA;eCE;gBCW;KDE;eEe;+BCE;KDQ;mCCG;KDI;GFO;EIE;qCCQ;KDE;GJgB;EME;qCHE;KGI;GNE;EOE;GPI;EQE;GRO;cSE;GTM;CDO;AWE"},"hasCjsExports":false},"type":"js/module"}]}
<?xml version="1.0" encoding="UTF-8"?>
<office:document-content xmlns:css3t="http://www.w3.org/TR/css3-text/" xmlns:grddl="http://www.w3.org/2003/g/data-view#" xmlns:xhtml="http://www.w3.org/1999/xhtml" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xforms="http://www.w3.org/2002/xforms" xmlns:dom="http://www.w3.org/2001/xml-events" xmlns:script="urn:oasis:names:tc:opendocument:xmlns:script:1.0" xmlns:form="urn:oasis:names:tc:opendocument:xmlns:form:1.0" xmlns:math="http://www.w3.org/1998/Math/MathML" xmlns:number="urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0" xmlns:field="urn:openoffice:names:experimental:ooo-ms-interop:xmlns:field:1.0" xmlns:meta="urn:oasis:names:tc:opendocument:xmlns:meta:1.0" xmlns:loext="urn:org:documentfoundation:names:experimental:office:xmlns:loext:1.0" xmlns:officeooo="http://openoffice.org/2009/office" xmlns:table="urn:oasis:names:tc:opendocument:xmlns:table:1.0" xmlns:chart="urn:oasis:names:tc:opendocument:xmlns:chart:1.0" xmlns:formx="urn:openoffice:names:experimental:ooxml-odf-interop:xmlns:form:1.0" xmlns:svg="urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0" xmlns:rpt="http://openoffice.org/2005/report" xmlns:dr3d="urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0" xmlns:tableooo="http://openoffice.org/2009/table" xmlns:draw="urn:oasis:names:tc:opendocument:xmlns:drawing:1.0" xmlns:of="urn:oasis:names:tc:opendocument:xmlns:of:1.2" xmlns:text="urn:oasis:names:tc:opendocument:xmlns:text:1.0" xmlns:style="urn:oasis:names:tc:opendocument:xmlns:style:1.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:calcext="urn:org:documentfoundation:names:experimental:calc:xmlns:calcext:1.0" xmlns:oooc="http://openoffice.org/2004/calc" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:drawooo="http://openoffice.org/2010/draw" xmlns:ooow="http://openoffice.org/2004/writer" xmlns:fo="urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0" xmlns:ooo="http://openoffice.org/2004/office" xmlns:office="urn:oasis:names:tc:opendocument:xmlns:office:1.0" office:version="1.3"><office:scripts/><office:font-face-decls><style:font-face style:name="Arial Unicode MS" svg:font-family="&apos;Arial Unicode MS&apos;" style:font-family-generic="swiss"/><style:font-face style:name="Arial Unicode MS1" svg:font-family="&apos;Arial Unicode MS&apos;" style:font-family-generic="system" style:font-pitch="variable"/><style:font-face style:name="Liberation Mono" svg:font-family="&apos;Liberation Mono&apos;" style:font-family-generic="modern" style:font-pitch="fixed"/><style:font-face style:name="Liberation Sans" svg:font-family="&apos;Liberation Sans&apos;" style:font-family-generic="swiss" style:font-pitch="variable"/><style:font-face style:name="Liberation Serif" svg:font-family="&apos;Liberation Serif&apos;" style:font-family-generic="roman" style:font-pitch="variable"/><style:font-face style:name="OpenSymbol" svg:font-family="OpenSymbol" style:font-charset="x-symbol"/><style:font-face style:name="PingFang SC" svg:font-family="&apos;PingFang SC&apos;" style:font-family-generic="system" style:font-pitch="variable"/><style:font-face style:name="Songti SC" svg:font-family="&apos;Songti SC&apos;" style:font-family-generic="system" style:font-pitch="variable"/></office:font-face-decls><office:automatic-styles><style:style style:name="P1" style:family="paragraph" style:parent-style-name="Preformatted_20_Text"><style:paragraph-properties fo:margin-top="0cm" fo:margin-bottom="0.499cm" style:contextual-spacing="false"/></style:style><style:style style:name="P2" style:family="paragraph" style:parent-style-name="Text_20_body" style:list-style-name="L1"/><style:style style:name="P3" style:family="paragraph" style:parent-style-name="Text_20_body" style:list-style-name="L1"><style:paragraph-properties fo:margin-top="0cm" fo:margin-bottom="0cm" style:contextual-spacing="false"/></style:style><style:style style:name="P4" style:family="paragraph" style:parent-style-name="Text_20_body" style:list-style-name="L2"/><style:style style:name="P5" style:family="paragraph" style:parent-style-name="Text_20_body" style:list-style-name="L2"><style:paragraph-properties fo:margin-top="0cm" fo:margin-bottom="0cm" style:contextual-spacing="false"/></style:style><style:style style:name="P6" style:family="paragraph" style:parent-style-name="Text_20_body" style:list-style-name="L3"/><style:style style:name="P7" style:family="paragraph" style:parent-style-name="Text_20_body" style:list-style-name="L3"><style:paragraph-properties fo:margin-top="0cm" fo:margin-bottom="0cm" style:contextual-spacing="false"/></style:style><text:list-style style:name="L1"><text:list-level-style-bullet text:level="1" text:style-name="Bullet_20_Symbols" loext:num-list-format="%1%." style:num-suffix="." text:bullet-char="•"><style:list-level-properties text:space-before="0.752cm" text:min-label-width="0.499cm"/></text:list-level-style-bullet><text:list-level-style-bullet text:level="2" text:style-name="Bullet_20_Symbols" loext:num-list-format="%2%." style:num-suffix="." text:bullet-char="•"><style:list-level-properties text:space-before="2.002cm" text:min-label-width="0.499cm"/></text:list-level-style-bullet><text:list-level-style-bullet text:level="3" text:style-name="Bullet_20_Symbols" loext:num-list-format="%3%." style:num-suffix="." text:bullet-char="•"><style:list-level-properties text:space-before="3.253cm" text:min-label-width="0.499cm"/></text:list-level-style-bullet><text:list-level-style-bullet text:level="4" text:style-name="Bullet_20_Symbols" loext:num-list-format="%4%." style:num-suffix="." text:bullet-char="•"><style:list-level-properties text:space-before="4.503cm" text:min-label-width="0.499cm"/></text:list-level-style-bullet><text:list-level-style-bullet text:level="5" text:style-name="Bullet_20_Symbols" loext:num-list-format="%5%." style:num-suffix="." text:bullet-char="•"><style:list-level-properties text:space-before="5.754cm" text:min-label-width="0.499cm"/></text:list-level-style-bullet><text:list-level-style-bullet text:level="6" text:style-name="Bullet_20_Symbols" loext:num-list-format="%6%." style:num-suffix="." text:bullet-char="•"><style:list-level-properties text:space-before="7.005cm" text:min-label-width="0.499cm"/></text:list-level-style-bullet><text:list-level-style-bullet text:level="7" text:style-name="Bullet_20_Symbols" loext:num-list-format="%7%." style:num-suffix="." text:bullet-char="•"><style:list-level-properties text:space-before="8.255cm" text:min-label-width="0.499cm"/></text:list-level-style-bullet><text:list-level-style-bullet text:level="8" text:style-name="Bullet_20_Symbols" loext:num-list-format="%8%." style:num-suffix="." text:bullet-char="•"><style:list-level-properties text:space-before="9.506cm" text:min-label-width="0.499cm"/></text:list-level-style-bullet><text:list-level-style-bullet text:level="9" text:style-name="Bullet_20_Symbols" loext:num-list-format="%9%." style:num-suffix="." text:bullet-char="•"><style:list-level-properties text:space-before="10.756cm" text:min-label-width="0.499cm"/></text:list-level-style-bullet><text:list-level-style-bullet text:level="10" text:style-name="Bullet_20_Symbols" loext:num-list-format="%10%." style:num-suffix="." text:bullet-char="•"><style:list-level-properties text:space-before="12.007cm" text:min-label-width="0.499cm"/></text:list-level-style-bullet></text:list-style><text:list-style style:name="L2"><text:list-level-style-bullet text:level="1" text:style-name="Bullet_20_Symbols" loext:num-list-format="%1%." style:num-suffix="." text:bullet-char="•"><style:list-level-properties text:space-before="0.752cm" text:min-label-width="0.499cm"/></text:list-level-style-bullet><text:list-level-style-bullet text:level="2" text:style-name="Bullet_20_Symbols" loext:num-list-format="%2%." style:num-suffix="." text:bullet-char="•"><style:list-level-properties text:space-before="2.002cm" text:min-label-width="0.499cm"/></text:list-level-style-bullet><text:list-level-style-bullet text:level="3" text:style-name="Bullet_20_Symbols" loext:num-list-format="%3%." style:num-suffix="." text:bullet-char="•"><style:list-level-properties text:space-before="3.253cm" text:min-label-width="0.499cm"/></text:list-level-style-bullet><text:list-level-style-bullet text:level="4" text:style-name="Bullet_20_Symbols" loext:num-list-format="%4%." style:num-suffix="." text:bullet-char="•"><style:list-level-properties text:space-before="4.503cm" text:min-label-width="0.499cm"/></text:list-level-style-bullet><text:list-level-style-bullet text:level="5" text:style-name="Bullet_20_Symbols" loext:num-list-format="%5%." style:num-suffix="." text:bullet-char="•"><style:list-level-properties text:space-before="5.754cm" text:min-label-width="0.499cm"/></text:list-level-style-bullet><text:list-level-style-bullet text:level="6" text:style-name="Bullet_20_Symbols" loext:num-list-format="%6%." style:num-suffix="." text:bullet-char="•"><style:list-level-properties text:space-before="7.005cm" text:min-label-width="0.499cm"/></text:list-level-style-bullet><text:list-level-style-bullet text:level="7" text:style-name="Bullet_20_Symbols" loext:num-list-format="%7%." style:num-suffix="." text:bullet-char="•"><style:list-level-properties text:space-before="8.255cm" text:min-label-width="0.499cm"/></text:list-level-style-bullet><text:list-level-style-bullet text:level="8" text:style-name="Bullet_20_Symbols" loext:num-list-format="%8%." style:num-suffix="." text:bullet-char="•"><style:list-level-properties text:space-before="9.506cm" text:min-label-width="0.499cm"/></text:list-level-style-bullet><text:list-level-style-bullet text:level="9" text:style-name="Bullet_20_Symbols" loext:num-list-format="%9%." style:num-suffix="." text:bullet-char="•"><style:list-level-properties text:space-before="10.756cm" text:min-label-width="0.499cm"/></text:list-level-style-bullet><text:list-level-style-bullet text:level="10" text:style-name="Bullet_20_Symbols" loext:num-list-format="%10%." style:num-suffix="." text:bullet-char="•"><style:list-level-properties text:space-before="12.007cm" text:min-label-width="0.499cm"/></text:list-level-style-bullet></text:list-style><text:list-style style:name="L3"><text:list-level-style-bullet text:level="1" text:style-name="Bullet_20_Symbols" loext:num-list-format="%1%." style:num-suffix="." text:bullet-char="•"><style:list-level-properties text:space-before="0.752cm" text:min-label-width="0.499cm"/></text:list-level-style-bullet><text:list-level-style-bullet text:level="2" text:style-name="Bullet_20_Symbols" loext:num-list-format="%2%." style:num-suffix="." text:bullet-char="•"><style:list-level-properties text:space-before="2.002cm" text:min-label-width="0.499cm"/></text:list-level-style-bullet><text:list-level-style-bullet text:level="3" text:style-name="Bullet_20_Symbols" loext:num-list-format="%3%." style:num-suffix="." text:bullet-char="•"><style:list-level-properties text:space-before="3.253cm" text:min-label-width="0.499cm"/></text:list-level-style-bullet><text:list-level-style-bullet text:level="4" text:style-name="Bullet_20_Symbols" loext:num-list-format="%4%." style:num-suffix="." text:bullet-char="•"><style:list-level-properties text:space-before="4.503cm" text:min-label-width="0.499cm"/></text:list-level-style-bullet><text:list-level-style-bullet text:level="5" text:style-name="Bullet_20_Symbols" loext:num-list-format="%5%." style:num-suffix="." text:bullet-char="•"><style:list-level-properties text:space-before="5.754cm" text:min-label-width="0.499cm"/></text:list-level-style-bullet><text:list-level-style-bullet text:level="6" text:style-name="Bullet_20_Symbols" loext:num-list-format="%6%." style:num-suffix="." text:bullet-char="•"><style:list-level-properties text:space-before="7.005cm" text:min-label-width="0.499cm"/></text:list-level-style-bullet><text:list-level-style-bullet text:level="7" text:style-name="Bullet_20_Symbols" loext:num-list-format="%7%." style:num-suffix="." text:bullet-char="•"><style:list-level-properties text:space-before="8.255cm" text:min-label-width="0.499cm"/></text:list-level-style-bullet><text:list-level-style-bullet text:level="8" text:style-name="Bullet_20_Symbols" loext:num-list-format="%8%." style:num-suffix="." text:bullet-char="•"><style:list-level-properties text:space-before="9.506cm" text:min-label-width="0.499cm"/></text:list-level-style-bullet><text:list-level-style-bullet text:level="9" text:style-name="Bullet_20_Symbols" loext:num-list-format="%9%." style:num-suffix="." text:bullet-char="•"><style:list-level-properties text:space-before="10.756cm" text:min-label-width="0.499cm"/></text:list-level-style-bullet><text:list-level-style-bullet text:level="10" text:style-name="Bullet_20_Symbols" loext:num-list-format="%10%." style:num-suffix="." text:bullet-char="•"><style:list-level-properties text:space-before="12.007cm" text:min-label-width="0.499cm"/></text:list-level-style-bullet></text:list-style></office:automatic-styles><office:body><office:text text:use-soft-page-breaks="true"><text:sequence-decls><text:sequence-decl text:display-outline-level="0" text:name="Illustration"/><text:sequence-decl text:display-outline-level="0" text:name="Table"/><text:sequence-decl text:display-outline-level="0" text:name="Text"/><text:sequence-decl text:display-outline-level="0" text:name="Drawing"/><text:sequence-decl text:display-outline-level="0" text:name="Figure"/></text:sequence-decls><text:h text:style-name="Heading_20_1" text:outline-level="1">Prompt complet pour sécuriser la fonctionnalité &quot;Mot de passe oublié&quot; - DeadPions</text:h><text:h text:style-name="Heading_20_2" text:outline-level="2">Contexte du projet</text:h><text:p text:style-name="Text_20_body">DeadPions est une application mobile de jeu multijoueur (React Native + Expo) avec un backend Node.js/Express et MongoDB. L&apos;authentification actuelle utilise JWT avec support Google OAuth.</text:p><text:p text:style-name="Text_20_body"><text:span text:style-name="Strong_20_Emphasis">Stack technique détaillée :</text:span></text:p><text:list text:style-name="L1"><text:list-item><text:p text:style-name="P3"><text:span text:style-name="Strong_20_Emphasis">Frontend</text:span> : React Native 0.81 (Expo SDK 54), Redux Toolkit, AsyncStorage </text:p></text:list-item><text:list-item><text:p text:style-name="P3"><text:span text:style-name="Strong_20_Emphasis">Backend</text:span> : Node.js, Express.js, MongoDB (Mongoose), Socket.io </text:p></text:list-item><text:list-item><text:p text:style-name="P3"><text:span text:style-name="Strong_20_Emphasis">Auth actuelle</text:span> : bcryptjs, jsonwebtoken, google-auth-library </text:p></text:list-item><text:list-item><text:p text:style-name="P2"><text:span text:style-name="Strong_20_Emphasis">Email</text:span> : Service non encore déterminé (à configurer) </text:p></text:list-item></text:list><text:p text:style-name="Horizontal_20_Line"/><text:h text:style-name="Heading_20_2" text:outline-level="2">Objectif</text:h><text:p text:style-name="Text_20_body">Implémenter un système sécurisé de réinitialisation de mot de passe respectant les meilleures pratiques OWASP et protégeant contre :</text:p><text:list text:style-name="L2"><text:list-item><text:p text:style-name="P5">✅ L&apos;énumération d&apos;utilisateurs </text:p></text:list-item><text:list-item><text:p text:style-name="P5">✅ Les attaques par force brute </text:p></text:list-item><text:list-item><text:p text:style-name="P5">✅ Les attaques de timing </text:p></text:list-item><text:list-item><text:p text:style-name="P5">✅ La réutilisation de tokens </text:p></text:list-item><text:list-item><text:p text:style-name="P4">✅ Les liens expirés ou compromis </text:p></text:list-item></text:list><text:p text:style-name="Horizontal_20_Line"/><text:h text:style-name="Heading_20_2" text:outline-level="2">Spécifications Techniques Backend</text:h><text:h text:style-name="Heading_20_3" text:outline-level="3">1. <text:span text:style-name="Strong_20_Emphasis">Modèle utilisateur (Mongoose)</text:span></text:h><text:p text:style-name="Text_20_body">Ajouter ces champs au schéma <text:span text:style-name="Source_20_Text">User</text:span> existant :</text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">// backend/models/User.js</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">const userSchema = new mongoose.Schema({</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>// ... champs existants (pseudo, email, password, etc.)</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/></text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>// Nouveaux champs pour reset password</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>resetPasswordToken: {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>type: String,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>default: null</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>},</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>resetPasswordExpires: {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>type: Date,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>default: null</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>},</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>resetPasswordAttempts: [{</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:soft-page-break/><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>ip: String,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>timestamp: { type: Date, default: Date.now }</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>}],</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>passwordHistory: [{</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>hash: String,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>changedAt: { type: Date, default: Date.now }</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>}],</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>lastPasswordChange: {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>type: Date,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>default: null</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>}</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">});</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">// Index pour auto-suppression des tokens expirés (TTL)</text:span></text:p><text:p text:style-name="P1"><text:span text:style-name="Source_20_Text">userSchema.index({ resetPasswordExpires: 1 }, { expireAfterSeconds: 0 });</text:span></text:p><text:p text:style-name="Horizontal_20_Line"/><text:h text:style-name="Heading_20_3" text:outline-level="3">2. <text:span text:style-name="Strong_20_Emphasis">Routes API (Express)</text:span></text:h><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">// backend/routes/auth.js</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">const express = require(&apos;express&apos;);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">const router = express.Router();</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">const { body } = require(&apos;express-validator&apos;);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">const authController = require(&apos;../controllers/authController&apos;);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">const rateLimiter = require(&apos;../middleware/rateLimiter&apos;);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">// Demande de réinitialisation - STRICT rate limit</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">router.post(</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>&apos;/forgot-password&apos;,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>rateLimiter.forgotPassword, // Max 3 requêtes/heure par IP</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>[</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>body(&apos;email&apos;)</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>.isEmail()</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>.normalizeEmail()</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>.withMessage(&apos;Email invalide&apos;)</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>],</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>authController.forgotPassword</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">// Validation du token (optionnel - pour afficher la page de reset)</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">router.get(</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>&apos;/reset-password/:token&apos;,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>authController.validateResetToken</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">// Changement du mot de passe</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">router.post(</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>&apos;/reset-password&apos;,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>rateLimiter.resetPassword, // Max 5 requêtes/heure par IP</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>[</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>body(&apos;token&apos;).notEmpty(),</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>body(&apos;newPassword&apos;)</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>.isLength({ min: 12 })</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>.matches(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&amp;#])[A-Za-z\d@$!%*?&amp;#]/)</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>.withMessage(&apos;Mot de passe trop faible&apos;)</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>],</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>authController.resetPassword</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="P1"><text:span text:style-name="Source_20_Text">module.exports = router;</text:span></text:p><text:p text:style-name="Horizontal_20_Line"><text:soft-page-break/></text:p><text:h text:style-name="Heading_20_3" text:outline-level="3">3. <text:span text:style-name="Strong_20_Emphasis">Middleware Rate Limiter</text:span></text:h><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">// backend/middleware/rateLimiter.js</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">const rateLimit = require(&apos;express-rate-limit&apos;);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">const MongoStore = require(&apos;rate-limit-mongo&apos;);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">// Store pour persistance cross-restart</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">const store = new MongoStore({</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>uri: process.env.MONGODB_URI,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>collectionName: &apos;rateLimits&apos;,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>expireTimeMs: 60 * 60 * 1000 // 1 heure</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">});</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">exports.forgotPassword = rateLimit({</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>store,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>windowMs: 60 * 60 * 1000, // 1 heure</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>max: 3, // 3 tentatives max</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>message: {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>error: &apos;Trop de tentatives. Réessayez dans 1 heure.&apos;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>},</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>standardHeaders: true,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>legacyHeaders: false,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>// Key basée sur IP + User-Agent pour éviter contournement</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>keyGenerator: (req) =&gt; {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>return `${req.ip}-${req.get(&apos;User-Agent&apos;)}`;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>}</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">});</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">exports.resetPassword = rateLimit({</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>store,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>windowMs: 60 * 60 * 1000,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>max: 5,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>message: {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>error: &apos;Trop de tentatives de changement. Réessayez plus tard.&apos;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>},</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>keyGenerator: (req) =&gt; req.ip</text:span></text:p><text:p text:style-name="P1"><text:span text:style-name="Source_20_Text">});</text:span></text:p><text:p text:style-name="Horizontal_20_Line"/><text:h text:style-name="Heading_20_3" text:outline-level="3">4. <text:span text:style-name="Strong_20_Emphasis">Contrôleur Principal</text:span></text:h><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">// backend/controllers/authController.js</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">const User = require(&apos;../models/User&apos;);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">const crypto = require(&apos;crypto&apos;);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">const bcrypt = require(&apos;bcryptjs&apos;);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">const emailService = require(&apos;../services/emailService&apos;);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">const { validationResult } = require(&apos;express-validator&apos;);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">// Délai artificiel constant pour éviter timing attacks</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">const RESPONSE_DELAY_MS = 300;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">// === ÉTAPE 1 : Demande de réinitialisation ===</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">exports.forgotPassword = async (req, res) =&gt; {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>const startTime = Date.now();</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/></text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>try {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>const errors = validationResult(req);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>if (!errors.isEmpty()) {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>await delay(RESPONSE_DELAY_MS, startTime);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>return res.status(400).json({ </text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:soft-page-break/><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>message: &apos;Email invalide&apos; </text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>});</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>}</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>const { email } = req.body;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>const user = await User.findOne({ email: email.toLowerCase() });</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>// TOUJOURS renvoyer le même message (anti-énumération)</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>const genericMessage = &apos;Si cet email existe, un lien de réinitialisation a été envoyé.&apos;;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>if (!user) {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>// Enregistrer tentative sur email inexistant (sécurité)</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>console.warn(`[SECURITY] Reset attempt on non-existent email: ${email} from IP: ${req.ip}`);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>await delay(RESPONSE_DELAY_MS, startTime);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>return res.json({ message: genericMessage });</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>}</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>// Rate limit par utilisateur (max 5/jour)</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>const recentAttempts = user.resetPasswordAttempts.filter(</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>a =&gt; Date.now() - a.timestamp &lt; 24 * 60 * 60 * 1000</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/></text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>if (recentAttempts.length &gt;= 5) {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>console.warn(`[SECURITY] User ${user.pseudo} exceeded daily reset limit`);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>await delay(RESPONSE_DELAY_MS, startTime);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>return res.json({ message: genericMessage }); // Pas d&apos;erreur explicite</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>}</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>// Générer token sécurisé (32 bytes = 256 bits)</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>const resetToken = crypto.randomBytes(32).toString(&apos;hex&apos;);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>const hashedToken = crypto</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>.createHash(&apos;sha256&apos;)</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>.update(resetToken)</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>.digest(&apos;hex&apos;);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>// Sauvegarder token haché + expiration (15 minutes)</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>user.resetPasswordToken = hashedToken;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>user.resetPasswordExpires = Date.now() + 15 * 60 * 1000; // 15 min</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>user.resetPasswordAttempts.push({</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>ip: req.ip,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>timestamp: Date.now()</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>});</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/></text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>// Nettoyer anciennes tentatives (garder 30 derniers jours)</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>user.resetPasswordAttempts = user.resetPasswordAttempts.filter(</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>a =&gt; Date.now() - a.timestamp &lt; 30 * 24 * 60 * 60 * 1000</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>await user.save();</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>// Envoyer email APRÈS sauvegarde DB (évite race conditions)</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>const resetURL = `${process.env.FRONTEND_URL}/reset-password/${resetToken}`;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>await emailService.sendPasswordReset(user.email, resetURL, user.pseudo);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>// Log sécurité</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>console.log(`[INFO] Password reset email sent to ${user.email}`);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>await delay(RESPONSE_DELAY_MS, startTime);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>return res.json({ message: genericMessage });</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>} catch (error) {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>console.error(&apos;[ERROR] Forgot password:&apos;, error);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:soft-page-break/><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>await delay(RESPONSE_DELAY_MS, startTime);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>return res.status(500).json({ </text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>message: &apos;Erreur serveur. Réessayez plus tard.&apos; </text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>});</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>}</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">};</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">// === ÉTAPE 2 : Validation du token (GET) ===</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">exports.validateResetToken = async (req, res) =&gt; {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>try {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>const { token } = req.params;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/></text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>const hashedToken = crypto</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>.createHash(&apos;sha256&apos;)</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>.update(token)</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>.digest(&apos;hex&apos;);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>const user = await User.findOne({</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>resetPasswordToken: hashedToken,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>resetPasswordExpires: { $gt: Date.now() }</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>});</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>if (!user) {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>return res.status(400).json({ </text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>valid: false,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>message: &apos;Lien invalide ou expiré&apos; </text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>});</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>}</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>return res.json({ </text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>valid: true,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>message: &apos;Token valide&apos; </text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>});</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>} catch (error) {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>console.error(&apos;[ERROR] Validate token:&apos;, error);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>return res.status(500).json({ </text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>valid: false,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>message: &apos;Erreur serveur&apos; </text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>});</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>}</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">};</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">// === ÉTAPE 3 : Changement du mot de passe ===</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">exports.resetPassword = async (req, res) =&gt; {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>const startTime = Date.now();</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>try {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>const errors = validationResult(req);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>if (!errors.isEmpty()) {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>await delay(RESPONSE_DELAY_MS, startTime);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>return res.status(400).json({ </text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>errors: errors.array() </text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>});</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>}</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>const { token, newPassword } = req.body;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/></text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>const hashedToken = crypto</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>.createHash(&apos;sha256&apos;)</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>.update(token)</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>.digest(&apos;hex&apos;);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>const user = await User.findOne({</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:soft-page-break/><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>resetPasswordToken: hashedToken,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>resetPasswordExpires: { $gt: Date.now() }</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>});</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>if (!user) {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>await delay(RESPONSE_DELAY_MS, startTime);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>return res.status(400).json({ </text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>message: &apos;Lien invalide ou expiré&apos; </text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>});</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>}</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>// Vérifier que le nouveau MDP est différent de l&apos;ancien</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>const isSamePassword = await bcrypt.compare(newPassword, user.password);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>if (isSamePassword) {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>await delay(RESPONSE_DELAY_MS, startTime);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>return res.status(400).json({ </text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>message: &apos;Le nouveau mot de passe doit être différent&apos; </text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>});</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>}</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>// Vérifier historique (optionnel - derniers 5 MDP)</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>if (user.passwordHistory &amp;&amp; user.passwordHistory.length &gt; 0) {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>const last5 = user.passwordHistory.slice(-5);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>for (const oldHash of last5) {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>const isReused = await bcrypt.compare(newPassword, oldHash.hash);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>if (isReused) {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>await delay(RESPONSE_DELAY_MS, startTime);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>return res.status(400).json({ </text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="12"/>message: &apos;Ce mot de passe a déjà été utilisé&apos; </text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>});</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>}</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>}</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>}</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>// Hacher nouveau mot de passe</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>const salt = await bcrypt.genSalt(12); // Coût élevé pour sécurité</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>const hashedPassword = await bcrypt.hash(newPassword, salt);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>// Sauvegarder ancien MDP dans l&apos;historique</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>if (!user.passwordHistory) user.passwordHistory = [];</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>user.passwordHistory.push({</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>hash: user.password,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>changedAt: new Date()</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>});</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>// Limiter historique à 10 entrées</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>if (user.passwordHistory.length &gt; 10) {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>user.passwordHistory = user.passwordHistory.slice(-10);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>}</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>// Mettre à jour</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>user.password = hashedPassword;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>user.resetPasswordToken = null;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>user.resetPasswordExpires = null;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>user.lastPasswordChange = new Date();</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/></text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>await user.save();</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>// Envoyer email de confirmation</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>await emailService.sendPasswordChangeConfirmation(user.email, user.pseudo);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>// Invalider toutes les sessions actives (optionnel - augmenter version JWT)</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>// user.jwtVersion = (user.jwtVersion || 0) + 1;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:soft-page-break/><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>console.log(`[INFO] Password successfully reset for ${user.email}`);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>await delay(RESPONSE_DELAY_MS, startTime);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>return res.json({ </text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>message: &apos;Mot de passe modifié avec succès&apos; </text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>});</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>} catch (error) {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>console.error(&apos;[ERROR] Reset password:&apos;, error);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>await delay(RESPONSE_DELAY_MS, startTime);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>return res.status(500).json({ </text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>message: &apos;Erreur serveur. Réessayez plus tard.&apos; </text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>});</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>}</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">};</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">// Fonction helper pour délai constant</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">function delay(targetMs, startTime) {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>const elapsed = Date.now() - startTime;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>const remaining = Math.max(0, targetMs - elapsed);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>return new Promise(resolve =&gt; setTimeout(resolve, remaining));</text:span></text:p><text:p text:style-name="P1"><text:span text:style-name="Source_20_Text">}</text:span></text:p><text:p text:style-name="Horizontal_20_Line"/><text:h text:style-name="Heading_20_3" text:outline-level="3">5. <text:span text:style-name="Strong_20_Emphasis">Service Email</text:span></text:h><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">// backend/services/emailService.js</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">const nodemailer = require(&apos;nodemailer&apos;);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">// Configuration SMTP (exemple avec Gmail - à adapter)</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">const transporter = nodemailer.createTransport({</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>service: &apos;gmail&apos;, // ou SMTP custom</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>auth: {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>user: process.env.EMAIL_USER,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>pass: process.env.EMAIL_PASSWORD // App Password recommandé</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>}</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">});</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">exports.sendPasswordReset = async (email, resetURL, pseudo) =&gt; {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>const mailOptions = {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>from: `&quot;DeadPions Support&quot; &lt;${process.env.EMAIL_USER}&gt;`,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>to: email,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>subject: &apos;Réinitialisation de votre mot de passe - DeadPions&apos;,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>html: `</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>&lt;div style=&quot;font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;&quot;&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>&lt;h2 style=&quot;color: #041c55;&quot;&gt;Bonjour ${pseudo},&lt;/h2&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>&lt;p&gt;Vous avez demandé la réinitialisation de votre mot de passe.&lt;/p&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>&lt;p&gt;Cliquez sur le bouton ci-dessous pour créer un nouveau mot de passe :&lt;/p&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>&lt;div style=&quot;text-align: center; margin: 30px 0;&quot;&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>&lt;a href=&quot;${resetURL}&quot; </text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="13"/>style=&quot;background-color: #f1c40f; color: #000; padding: 12px 24px; </text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="20"/>text-decoration: none; border-radius: 5px; font-weight: bold;&quot;&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="12"/>Réinitialiser mon mot de passe</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>&lt;/a&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>&lt;/div&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>&lt;p style=&quot;color: #666; font-size: 14px;&quot;&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>⏰ Ce lien expire dans &lt;strong&gt;15 minutes&lt;/strong&gt;.</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>&lt;/p&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>&lt;p style=&quot;color: #666; font-size: 14px;&quot;&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:soft-page-break/><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>Si vous n&apos;avez pas demandé cette réinitialisation, ignorez cet email. </text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>Votre mot de passe reste inchangé.</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>&lt;/p&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>&lt;hr style=&quot;margin: 30px 0; border: none; border-top: 1px solid #eee;&quot;&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>&lt;p style=&quot;color: #999; font-size: 12px;&quot;&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>Pour des raisons de sécurité, ne partagez jamais ce lien.</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>&lt;/p&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>&lt;/div&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>`</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>};</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>try {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>await transporter.sendMail(mailOptions);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>console.log(`[EMAIL] Reset password email sent to ${email}`);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>} catch (error) {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>console.error(&apos;[EMAIL ERROR]&apos;, error);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>throw new Error(&apos;Impossible d\&apos;envoyer l\&apos;email&apos;);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>}</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">};</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">exports.sendPasswordChangeConfirmation = async (email, pseudo) =&gt; {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>const mailOptions = {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>from: `&quot;DeadPions Support&quot; &lt;${process.env.EMAIL_USER}&gt;`,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>to: email,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>subject: &apos;Votre mot de passe a été modifié - DeadPions&apos;,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>html: `</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>&lt;div style=&quot;font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;&quot;&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>&lt;h2 style=&quot;color: #041c55;&quot;&gt;Bonjour ${pseudo},&lt;/h2&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>&lt;p&gt;✅ Votre mot de passe a été modifié avec succès.&lt;/p&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>&lt;p style=&quot;color: #666;&quot;&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>Si vous n&apos;êtes pas à l&apos;origine de ce changement, </text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>contactez immédiatement notre support à </text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>&lt;a href=&quot;mailto:support@deadpions.com&quot;&gt;support@deadpions.com&lt;/a&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>&lt;/p&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>&lt;p style=&quot;color: #999; font-size: 12px; margin-top: 30px;&quot;&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>Cet email a été envoyé le ${new Date().toLocaleString(&apos;fr-FR&apos;)}</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>&lt;/p&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>&lt;/div&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>`</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>};</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>try {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>await transporter.sendMail(mailOptions);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>} catch (error) {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>console.error(&apos;[EMAIL ERROR] Confirmation email failed:&apos;, error);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>// Ne pas bloquer le processus si l&apos;email de confirmation échoue</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>}</text:span></text:p><text:p text:style-name="P1"><text:span text:style-name="Source_20_Text">};</text:span></text:p><text:p text:style-name="Horizontal_20_Line"/><text:h text:style-name="Heading_20_2" text:outline-level="2">Spécifications Frontend (React Native)</text:h><text:h text:style-name="Heading_20_3" text:outline-level="3">6. <text:span text:style-name="Strong_20_Emphasis">Écran &quot;Mot de passe oublié&quot;</text:span></text:h><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">// src/screens/ForgotPasswordScreen.js</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">import React, { useState } from &apos;react&apos;;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">import {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>View,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>Text,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>TextInput,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:soft-page-break/><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>TouchableOpacity,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>StyleSheet,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>Alert,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>ActivityIndicator,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>KeyboardAvoidingView,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>Platform</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">} from &apos;react-native&apos;;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">import axios from &apos;axios&apos;;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">import { API_URL } from &apos;../config&apos;;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">const ForgotPasswordScreen = ({ navigation }) =&gt; {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>const [email, setEmail] = useState(&apos;&apos;);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>const [loading, setLoading] = useState(false);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>const [emailSent, setEmailSent] = useState(false);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>const handleSubmit = async () =&gt; {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>// Validation basique côté client</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>if (!email || !email.includes(&apos;@&apos;)) {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>Alert.alert(&apos;Erreur&apos;, &apos;Veuillez entrer un email valide&apos;);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>return;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>}</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>setLoading(true);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>try {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>const response = await axios.post(`${API_URL}/auth/forgot-password`, {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>email: email.trim().toLowerCase()</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>});</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>setEmailSent(true);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>Alert.alert(</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>&apos;Email envoyé&apos;,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>response.data.message,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>[</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>{</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="12"/>text: &apos;OK&apos;,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="12"/>onPress: () =&gt; navigation.goBack()</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>}</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>]</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>} catch (error) {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>const message = error.response?.data?.message || </text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="21"/>&apos;Une erreur est survenue. Réessayez plus tard.&apos;;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>Alert.alert(&apos;Erreur&apos;, message);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>} finally {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>setLoading(false);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>}</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>};</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>return (</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>&lt;KeyboardAvoidingView </text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>style={styles.container}</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>behavior={Platform.OS === &apos;ios&apos; ? &apos;padding&apos; : &apos;height&apos;}</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>&lt;View style={styles.content}&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>&lt;Text style={styles.title}&gt;Mot de passe oublié ?&lt;/Text&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>&lt;Text style={styles.subtitle}&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>Entrez votre email pour recevoir un lien de réinitialisation</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>&lt;/Text&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>&lt;TextInput</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>style={styles.input}</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>placeholder=&quot;Email&quot;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:soft-page-break/><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>placeholderTextColor=&quot;#999&quot;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>value={email}</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>onChangeText={setEmail}</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>keyboardType=&quot;email-address&quot;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>autoCapitalize=&quot;none&quot;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>autoCorrect={false}</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>editable={!loading &amp;&amp; !emailSent}</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>/&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>&lt;TouchableOpacity</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>style={[styles.button, loading &amp;&amp; styles.buttonDisabled]}</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>onPress={handleSubmit}</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>disabled={loading || emailSent}</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>{loading ? (</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="12"/>&lt;ActivityIndicator color=&quot;#fff&quot; /&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>) : (</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="12"/>&lt;Text style={styles.buttonText}&gt;Envoyer le lien&lt;/Text&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>)}</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>&lt;/TouchableOpacity&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>&lt;TouchableOpacity</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>style={styles.backButton}</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>onPress={() =&gt; navigation.goBack()}</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>&lt;Text style={styles.backText}&gt;Retour à la connexion&lt;/Text&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>&lt;/TouchableOpacity&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>&lt;/View&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>&lt;/KeyboardAvoidingView&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">};</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">const styles = StyleSheet.create({</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>container: {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>flex: 1,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>backgroundColor: &apos;#041c55&apos;,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>},</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>content: {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>flex: 1,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>justifyContent: &apos;center&apos;,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>paddingHorizontal: 30,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>},</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>title: {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>fontSize: 28,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>fontWeight: &apos;bold&apos;,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>color: &apos;#fff&apos;,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>marginBottom: 10,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>textAlign: &apos;center&apos;,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>},</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>subtitle: {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>fontSize: 16,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>color: &apos;#ccc&apos;,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>marginBottom: 30,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>textAlign: &apos;center&apos;,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>},</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>input: {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>backgroundColor: &apos;rgba(255,255,255,0.1)&apos;,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>borderWidth: 1,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>borderColor: &apos;#f1c40f&apos;,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>borderRadius: 10,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>padding: 15,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>color: &apos;#fff&apos;,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>fontSize: 16,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>marginBottom: 20,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:soft-page-break/><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>},</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>button: {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>backgroundColor: &apos;#f1c40f&apos;,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>padding: 15,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>borderRadius: 10,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>alignItems: &apos;center&apos;,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>marginBottom: 20,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>},</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>buttonDisabled: {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>opacity: 0.6,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>},</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>buttonText: {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>color: &apos;#000&apos;,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>fontSize: 18,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>fontWeight: &apos;bold&apos;,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>},</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>backButton: {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>alignItems: &apos;center&apos;,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>},</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>backText: {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>color: &apos;#f1c40f&apos;,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>fontSize: 16,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>},</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">});</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="P1"><text:span text:style-name="Source_20_Text">export default ForgotPasswordScreen;</text:span></text:p><text:h text:style-name="Heading_20_3" text:outline-level="3">7. <text:span text:style-name="Strong_20_Emphasis">Écran &quot;Réinitialisation du mot de passe&quot;</text:span></text:h><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">// src/screens/ResetPasswordScreen.js</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">import React, { useState, useEffect } from &apos;react&apos;;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">import {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>View,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>Text,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>TextInput,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>TouchableOpacity,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>StyleSheet,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>Alert,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>ActivityIndicator</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">} from &apos;react-native&apos;;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">import axios from &apos;axios&apos;;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">import { API_URL } from &apos;../config&apos;;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">const ResetPasswordScreen = ({ route, navigation }) =&gt; {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>const { token } = route.params; // Token passé via deep link</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>const [newPassword, setNewPassword] = useState(&apos;&apos;);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>const [confirmPassword, setConfirmPassword] = useState(&apos;&apos;);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>const [loading, setLoading] = useState(false);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>const [validatingToken, setValidatingToken] = useState(true);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>const [tokenValid, setTokenValid] = useState(false);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>// Valider le token au chargement</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>useEffect(() =&gt; {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>validateToken();</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>}, []);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>const validateToken = async () =&gt; {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>try {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>const response = await axios.get(`${API_URL}/auth/reset-password/${token}`);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>if (response.data.valid) {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>setTokenValid(true);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>} else {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:soft-page-break/><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>Alert.alert(&apos;Lien invalide&apos;, response.data.message);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>navigation.replace(&apos;Login&apos;);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>}</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>} catch (error) {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>Alert.alert(&apos;Erreur&apos;, &apos;Lien invalide ou expiré&apos;);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>navigation.replace(&apos;Login&apos;);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>} finally {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>setValidatingToken(false);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>}</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>};</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>const validatePassword = (password) =&gt; {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>const minLength = password.length &gt;= 12;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>const hasUpper = /[A-Z]/.test(password);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>const hasLower = /[a-z]/.test(password);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>const hasNumber = /\d/.test(password);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>const hasSpecial = /[@$!%*?&amp;#]/.test(password);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>return minLength &amp;&amp; hasUpper &amp;&amp; hasLower &amp;&amp; hasNumber &amp;&amp; hasSpecial;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>};</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>const handleSubmit = async () =&gt; {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>if (!newPassword || !confirmPassword) {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>Alert.alert(&apos;Erreur&apos;, &apos;Veuillez remplir tous les champs&apos;);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>return;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>}</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>if (newPassword !== confirmPassword) {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>Alert.alert(&apos;Erreur&apos;, &apos;Les mots de passe ne correspondent pas&apos;);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>return;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>}</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>if (!validatePassword(newPassword)) {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>Alert.alert(</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>&apos;Mot de passe trop faible&apos;,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>&apos;Le mot de passe doit contenir :\n&apos; +</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>&apos;• Au moins 12 caractères\n&apos; +</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>&apos;• Une majuscule\n&apos; +</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>&apos;• Une minuscule\n&apos; +</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>&apos;• Un chiffre\n&apos; +</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>&apos;• Un caractère spécial (@$!%*?&amp;#)&apos;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>return;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>}</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>setLoading(true);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>try {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>const response = await axios.post(`${API_URL}/auth/reset-password`, {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>token,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>newPassword</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>});</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>Alert.alert(</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>&apos;Succès&apos;,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>response.data.message,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>[</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>{</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="12"/>text: &apos;Se connecter&apos;,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="12"/>onPress: () =&gt; navigation.replace(&apos;Login&apos;)</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>}</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>]</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:soft-page-break/><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>} catch (error) {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>const message = error.response?.data?.message || </text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="21"/>&apos;Une erreur est survenue&apos;;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>Alert.alert(&apos;Erreur&apos;, message);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>} finally {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>setLoading(false);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>}</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>};</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>if (validatingToken) {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>return (</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>&lt;View style={[styles.container, styles.centered]}&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>&lt;ActivityIndicator size=&quot;large&quot; color=&quot;#f1c40f&quot; /&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>&lt;Text style={styles.loadingText}&gt;Validation du lien...&lt;/Text&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>&lt;/View&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>}</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>if (!tokenValid) {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>return null; // Navigation gérée dans validateToken</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>}</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>return (</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>&lt;View style={styles.container}&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>&lt;View style={styles.content}&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>&lt;Text style={styles.title}&gt;Nouveau mot de passe&lt;/Text&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>&lt;Text style={styles.subtitle}&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>Créez un mot de passe fort et sécurisé</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>&lt;/Text&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>&lt;TextInput</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>style={styles.input}</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>placeholder=&quot;Nouveau mot de passe&quot;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>placeholderTextColor=&quot;#999&quot;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>value={newPassword}</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>onChangeText={setNewPassword}</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>secureTextEntry</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>autoCapitalize=&quot;none&quot;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>/&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>&lt;TextInput</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>style={styles.input}</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>placeholder=&quot;Confirmer le mot de passe&quot;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>placeholderTextColor=&quot;#999&quot;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>value={confirmPassword}</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>onChangeText={setConfirmPassword}</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>secureTextEntry</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>autoCapitalize=&quot;none&quot;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>/&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>&lt;View style={styles.requirements}&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>&lt;Text style={styles.requirementsTitle}&gt;Le mot de passe doit contenir :&lt;/Text&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>&lt;Text style={styles.requirementItem}&gt;✓ Au moins 12 caractères&lt;/Text&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>&lt;Text style={styles.requirementItem}&gt;✓ Majuscules et minuscules&lt;/Text&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>&lt;Text style={styles.requirementItem}&gt;✓ Au moins un chiffre&lt;/Text&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>&lt;Text style={styles.requirementItem}&gt;✓ Un caractère spécial (@$!%*?&amp;#)&lt;/Text&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>&lt;/View&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>&lt;TouchableOpacity</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>style={[styles.button, loading &amp;&amp; styles.buttonDisabled]}</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>onPress={handleSubmit}</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>disabled={loading}</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:soft-page-break/><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>{loading ? (</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="12"/>&lt;ActivityIndicator color=&quot;#fff&quot; /&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>) : (</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="12"/>&lt;Text style={styles.buttonText}&gt;Réinitialiser&lt;/Text&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="10"/>)}</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="8"/>&lt;/TouchableOpacity&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>&lt;/View&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>&lt;/View&gt;</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">};</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">const styles = StyleSheet.create({</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>container: {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>flex: 1,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>backgroundColor: &apos;#041c55&apos;,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>},</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>centered: {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>justifyContent: &apos;center&apos;,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>alignItems: &apos;center&apos;,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>},</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>content: {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>flex: 1,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>justifyContent: &apos;center&apos;,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>paddingHorizontal: 30,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>},</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>title: {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>fontSize: 28,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>fontWeight: &apos;bold&apos;,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>color: &apos;#fff&apos;,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>marginBottom: 10,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>textAlign: &apos;center&apos;,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>},</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>subtitle: {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>fontSize: 16,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>color: &apos;#ccc&apos;,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>marginBottom: 30,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>textAlign: &apos;center&apos;,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>},</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>input: {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>backgroundColor: &apos;rgba(255,255,255,0.1)&apos;,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>borderWidth: 1,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>borderColor: &apos;#f1c40f&apos;,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>borderRadius: 10,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>padding: 15,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>color: &apos;#fff&apos;,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>fontSize: 16,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>marginBottom: 15,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>},</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>requirements: {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>backgroundColor: &apos;rgba(255,255,255,0.05)&apos;,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>padding: 15,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>borderRadius: 10,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>marginBottom: 20,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>},</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>requirementsTitle: {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>color: &apos;#f1c40f&apos;,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>fontSize: 14,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>fontWeight: &apos;bold&apos;,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>marginBottom: 8,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>},</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>requirementItem: {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>color: &apos;#ccc&apos;,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>fontSize: 12,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:soft-page-break/><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>marginBottom: 4,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>},</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>button: {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>backgroundColor: &apos;#f1c40f&apos;,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>padding: 15,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>borderRadius: 10,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>alignItems: &apos;center&apos;,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>},</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>buttonDisabled: {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>opacity: 0.6,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>},</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>buttonText: {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>color: &apos;#000&apos;,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>fontSize: 18,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>fontWeight: &apos;bold&apos;,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>},</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>loadingText: {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>color: &apos;#fff&apos;,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>marginTop: 10,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>fontSize: 16,</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>},</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">});</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="P1"><text:span text:style-name="Source_20_Text">export default ResetPasswordScreen;</text:span></text:p><text:p text:style-name="Horizontal_20_Line"/><text:h text:style-name="Heading_20_2" text:outline-level="2">Configuration &amp; Déploiement</text:h><text:h text:style-name="Heading_20_3" text:outline-level="3">8. <text:span text:style-name="Strong_20_Emphasis">Variables d&apos;environnement (.env)</text:span></text:h><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"># Backend</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">MONGODB_URI=mongodb://localhost:27017/deadpions</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">JWT_SECRET=votre_secret_jwt_ultra_securise_ici</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">FRONTEND_URL=exp://localhost:19000 <text:s/># Pour dev Expo</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">EMAIL_USER=votre-email@gmail.com</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">EMAIL_PASSWORD=votre_app_password_gmail</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"># Production</text:span></text:p><text:p text:style-name="P1"><text:span text:style-name="Source_20_Text">FRONTEND_URL=https://deadpions.app</text:span></text:p><text:h text:style-name="Heading_20_3" text:outline-level="3">9. <text:span text:style-name="Strong_20_Emphasis">Installation des dépendances</text:span></text:h><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"># Backend</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">cd backend</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">npm install express-rate-limit rate-limit-mongo nodemailer</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"># Frontend (si besoin)</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">cd ../frontend</text:span></text:p><text:p text:style-name="P1"><text:span text:style-name="Source_20_Text">npm install axios</text:span></text:p><text:h text:style-name="Heading_20_3" text:outline-level="3">10. <text:span text:style-name="Strong_20_Emphasis">Tests de sécurité recommandés</text:span></text:h><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">// backend/tests/security.test.js (avec Jest)</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text">describe(&apos;Password Reset Security&apos;, () =&gt; {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>it(&apos;should not reveal if email exists&apos;, async () =&gt; {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>const res1 = await request(app)</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>.post(&apos;/api/auth/forgot-password&apos;)</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>.send({ email: &apos;exists@test.com&apos; });</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/></text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:soft-page-break/><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>const res2 = await request(app)</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>.post(&apos;/api/auth/forgot-password&apos;)</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="6"/>.send({ email: &apos;fake@test.com&apos; });</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/></text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>expect(res1.body.message).toBe(res2.body.message);</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>});</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>it(&apos;should enforce rate limiting&apos;, async () =&gt; {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>// ... tests de rate limit</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>});</text:span></text:p><text:p text:style-name="Preformatted_20_Text"/><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>it(&apos;should reject weak passwords&apos;, async () =&gt; {</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="4"/>// ... tests de validation</text:span></text:p><text:p text:style-name="Preformatted_20_Text"><text:span text:style-name="Source_20_Text"><text:s text:c="2"/>});</text:span></text:p><text:p text:style-name="P1"><text:span text:style-name="Source_20_Text">});</text:span></text:p><text:p text:style-name="Horizontal_20_Line"/><text:h text:style-name="Heading_20_2" text:outline-level="2">Checklist de déploiement</text:h><text:list text:style-name="L3"><text:list-item><text:p text:style-name="P7">[ ] Configurer HTTPS obligatoire (Let&apos;s Encrypt) </text:p></text:list-item><text:list-item><text:p text:style-name="P7">[ ] Activer CORS uniquement pour domaines autorisés </text:p></text:list-item><text:list-item><text:p text:style-name="P7">[ ] Configurer service email en production (SendGrid/Mailgun recommandés) </text:p></text:list-item><text:list-item><text:p text:style-name="P7">[ ] Implémenter monitoring des tentatives suspectes (Sentry/LogRocket) </text:p></text:list-item><text:list-item><text:p text:style-name="P7">[ ] Tester sur iOS/Android réels (pas seulement simulateur) </text:p></text:list-item><text:list-item><text:p text:style-name="P7">[ ] Configurer deep links pour ouvrir app depuis email </text:p></text:list-item><text:list-item><text:p text:style-name="P7">[ ] Ajouter CAPTCHA si abus détectés (hCaptcha recommandé) </text:p></text:list-item><text:list-item><text:p text:style-name="P6">[ ] Documenter procédure de support pour utilisateurs bloqués </text:p></text:list-item></text:list><text:p text:style-name="Horizontal_20_Line"/><text:p text:style-name="Text_20_body"><text:span text:style-name="Strong_20_Emphasis">Ce système implémente toutes les protections OWASP essentielles et est prêt pour production !</text:span> 🔒</text:p><text:p text:style-name="Standard"/></office:text></office:body></office:document-content>